@page "{id:int}"
@model Jas.Areas.Ptg.Pages.PlateDetailModel
@{
    ViewData["Title"] = "Plátový stojan";
}

<div class="container my-5">

    <h1>@Model.Stand.Code @Model.Stand.Name</h1>
    <!-- Thumbnaily plat (AJAX do #plate-content) -->
    <div class="d-flex flex-wrap justify-content-center gap-2 mt-2 mb-4">
        @for (int i = 0; i < Model.Plates.Count; i++)
        {
            var plate = Model.Plates[i];
            var isActive = (i + 1 == Model.Plate);
            var borderClass = isActive ? "border-primary border-3" : "border-secondary";

            <a asp-area="Ptg"
               asp-page="PlateDetail"
               asp-page-handler="Plate"
               asp-route-id="@Model.Stand!.IdStand"
               asp-route-plate="@(i + 1)"
               data-ajax="true"
               data-ajax-method="get"
               data-ajax-update="#plate-content"
               data-ajax-mode="replace"
               class="thumb"
               data-plate="@(i + 1)">
                <img src="@(string.IsNullOrEmpty(plate.ImgUrl) ? "/images/no-picture.png" : plate.ImgUrl)"
                     alt="Plato @(i + 1)"
                     class="img-thumbnail @borderClass"
                     style="height: 100px;" />
            </a>
        }
    </div>

    <!-- Sem se vkládá partial s obrázkem, tabulkou i TLAČÍTKY -->
    <div id="plate-content">
        @await Html.PartialAsync("_PlateContent", new Jas.Areas.Ptg.Pages.PlateContentVm
        {
            StandId = Model.Stand!.IdStand,
                StandName = Model.Stand!.Name,
                StandType = Model.Stand!.Type,
                PlateIndex = Model.Plate,
                PlateDescription = Model.Plates[Model.Plate - 1].Description!,
                TotalPlates = Model.Plates.Count,
                ImgUrl = string.IsNullOrEmpty(Model.CurrentPlate?.ImgUrl) ? "/images/no-picture.png" : Model.CurrentPlate!.ImgUrl,
                Items = Model.PlateItems.Where(x => x.IdPtPlate == Model.CurrentPlate!.Id)
                .OrderBy(x => x.ItemOrder)
                .ToList()
                })
    </div>
</div>

@section Scripts {
    <script src="~/js/ptg/stand-detail.js" asp-append-version="true"></script>
}
